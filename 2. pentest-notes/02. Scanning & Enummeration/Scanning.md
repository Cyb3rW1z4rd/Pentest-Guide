# Nmap, Hping3

## NMAP

See the Nmap page for the reference guide: [https://nmap.org/book/man.html](https://nmap.org/book/man.html)

A generic scan is `nmap -A -T4 scan.nmap.org`

| SCAN TYPES |  |
| :--- | :--- |
| **-sn** : ping scan       **-sP** in older versions for host scans | **-sU** : udp scan |
| **-sS** : syn scan   \[default when run as root\] | **-sO** : protocol scan |
| **-sT** : TCP connect scan | **-sF** : FIN scan |
| **-sN** : NULL scan |  |

| OPTIONS |  |
| :--- | :--- |
| **-p** 1-65535 : ports | **-sV** : version detection |
| **-T** \[0-5\] : timing of scan | **-Pn**: Treat all hosts as online -- skip host discovery |
| **-n** : no dns resolution | **-6** : IPv6 scan |
| **-O** : OS detection | -- randomize-hosts |
| **-A** : equals -O, -sC, -sV and trace route | **-p-** : scan all ports                                                                       **use --allports** for no exclusions like port 9100. By default, Nmap version detection skips TCP port 9100 because some printers simply print anything sent to that port, leading to dozens of pages of HTTP GET requests, binary SSL session requests, etc. |

| ADVANCED OPTIONS | --reason  reason for status |
| :--- | :--- |
| **-sV** : service version/detection scan | **-tt**l : set ttl |
| **-traceroute** | **--script** scriptname or **script=**scriptname |
| **-sC** : use default scripts | **-v** verbose also **-vv** or **-vvv** for more verbose |
| **--version-all** : try every single probe for version detection | **--osscan-guess**: Guess OS more agressivly |

### Host discovery

A simple way to detect hosts is with a ping sweep. A ping -or an ICMP echo request request that machines are designed to respond to - is a simple "are you there".

`nmap –sn 192.168.0.0/24` ****or `netdiscover –i eth0`

**On the same network nmap uses arp scan**. Use `--disable-arp-ping` parameter to use ICMP

When Nmap runs a normal scan, it will first run a ping sweep and then follow up with actual port scans. If hosts are not responding to a ping, they won't be fully scanned. By running a scan with the `-Pn` flag, Nmap will completely skip the initial ping sweep and will scan all hosts in the specified target range.

**Slow Comprehensive Scan**

`nmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 --script "default or (discovery and safe)" $ip/24`

### Port Scanning

Nmap uses a SYN scan as default \(-sS\) but only when run as root. Otherwise it reverts to a "connect" scan.

`-sC` = use default scripts

`-sV` = service Version scan, Version detection

`-sS` = sync scan, quick, stealthy and is default.

`-O`= OS detection

`-A equals -O and -sV and -sC and --traceroute`

`-oA` = output all formats or –oN for text

`-T4` is a timing flag. T3 is default.

`-p-` = all ports or`--allports`

`-A` = for fingerprinting and banner scanning

`-v` = verbose in 99% of cases

`--reason`= reason for status type

### UDP Ports

[https://nmap.org/book/scan-methods-udp-scan.html](https://nmap.org/book/scan-methods-udp-scan.html)

`nmap -sUV -T4 -F --version-intensity 0 scanme.nmap.org -v`

`-sU`\(UDP scans\)

While most popular services on the Internet run over the TCP protocol, [UDP](http://www.rfc-editor.org/rfc/rfc768.txt) services are widely deployed. DNS, SNMP, and DHCP \(registered ports 53, 161/162, and 67/68\) are three of the most common. Because UDP scanning is generally slower and more difficult than TCP, some security auditors ignore these ports. This is a mistake, as exploitable UDP services are quite common and attackers certainly don't ignore the whole protocol. Fortunately, Nmap can help inventory UDP ports.

UDP scan is activated with the`-sU`option. It can be combined with a TCP scan type such as SYN scan \(`-sS`\) to check both protocols during the same run.

UDP scan works by sending a UDP packet to every targeted port. For some common ports such as 53 and 161, a protocol-specific payload is sent to increase response rate, but for most ports the packet is empty unless the`--data`,`--data-string`, or`--data-length`options are specified. If an ICMP port unreachable error \(type 3, code 3\) is returned, the port is`closed`. Other ICMP unreachable errors \(type 3, codes 0, 1, 2, 9, 10, or 13\) mark the port as`filtered`. Occasionally, a service will respond with a UDP packet, proving that it is`open`. If no response is received after retransmissions, the port is classified as`open|filtered`. This means that the port could be open, or perhaps packet filters are blocking the communication. Version detection \(`-sV`\) can be used to help differentiate the truly open ports from the filtered ones.

A big challenge with UDP scanning is doing it quickly. Open and filtered ports rarely send any response, leaving Nmap to time out and then conduct retransmissions just in case the probe or response were lost. Closed ports are often an even bigger problem. They usually send back an ICMP port unreachable error. But unlike the RST packets sent by closed TCP ports in response to a SYN or connect scan, many hosts rate limitICMP port unreachable messages by default. Linux and Solaris are particularly strict about this. For example, the Linux 2.4.20 kernel limits destination unreachable messages to one per second \(in`net/ipv4/icmp.c`\).

Nmap detects rate limiting and slows down accordingly to avoid flooding the network with useless packets that the target machine will drop. Unfortunately, a Linux-style limit of one packet per second makes a 65,536-port scan take more than 18 hours. Ideas for speeding your UDP scans up include scanning more hosts in parallel, doing a quick scan of just the popular ports first, scanning from behind the firewall, and using`--host-timeout`to skip slow hosts.

### NMAP NSE scripts

You can update the NSE scripts by running Nmap with the flag `nmap--script-updatedb`, which updates the script database.

Scripts are in `/usr/share/nmap/scripts`

> \(locate \*.nse \| grep servicename\)

**NSE scripts define a list of categories they belong to. Currently defined categories are** `auth`,`broadcast`,`brute`,`default, discovery`,`dos`,`exploit`,`external`,`fuzzer`,`intrusive`,`malware`,`safe`,`version`, and`vuln`. Category names are not case sensitive.

#### `General vulnerability scans`

`nmap -sV --script=exploit 192.168.0.17` for scanning with all the exploit scripts

`nmap -sV --script=vuln 192.168.0.27` for scanning with all the vuln scripts

**Run nmap for all backdoors, vulnerabilities**

`nmap --script="malware,vuln,exploit" -vv 192.168.0.33 -sV -Pn -n -O`

`nmap -sV --script=nmap-vulners/vulners.nse 192.168.0.1`

`nmap -sV --script=vulscan/vulscan.nse --script-args vulscandb=scipvuldb.csv -p 21,22,80,139,5432,5900,6667 192.168.0.17`

**Scan per port from all databases** `nmap -sV --script=nmap-vulners/vulners.nse,vulscan/vulscan.nse -p 21 192.168.0.17`

`nmap --script nmap-vulners,vulscan/vulscan.nse --script-args vulscandb=exploitdb.csv -sV <target IP>`

There are the following pre-installed databases available at the moment:

* _**scipvuldb.csv**_ - [https://vuldb.com](https://vuldb.com/)
* cve.csv - [http://cve.mitre.org](http://cve.mitre.org/)
* **osvdb.csv** - [http://www.osvdb.org](http://www.osvdb.org/)
* _**securityfocus.csv**_ - [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
* securitytracker.csv - [http://www.securitytracker.com](http://www.securitytracker.com/)
* **xforce.csv** - [http://xforce.iss.net](http://xforce.iss.net/)
* **exploitdb.csv** - [http://www.exploit-db.com](http://www.exploit-db.com/)
* openvas.csv - [http://www.openvas.org](http://www.openvas.org/)

Update the databases by executing the script `updateFiles.sh` in the directory `/usr/share/nmap/scripts/vulscan/utilities/updater`

**Auth-Owners for Ident server**

`nmap --script=auth-owners 192.168.0.29 | grep auth-owners > owners.txt`

## Hping3

[https://null-byte.wonderhowto.com/how-to/hack-like-pro-conduct-active-reconnaissance-your-target-with-hping3-0148092/](https://null-byte.wonderhowto.com/how-to/hack-like-pro-conduct-active-reconnaissance-your-target-with-hping3-0148092/)

hping3 -c 1 -V -p 80 -s 5050 -F victim.com

`-c`= packet count

`-V` = verbose

`-S` = SYN flag

`-F`= FIN flag

`-Y` = NULL flag

`-A` = ACK flag

`-U` = Urgent flag

`-UPF` = christmas scan \(URG+PSH+FIN\)

`-p` = port . or `--scan 1-500` or `--scan 1-500,621,771` or `--scan all` `--scan '22,23,80,100-200,!81,!53'` ! = not included then has to be between ' ' _**for combinations and ranges**_

`-s` = source port

![](../../.gitbook/assets/unnamed-3.jpg)

### Firewall and IDS/IPS evasion

[https://resources.infosecinstitute.com/nmap-evade-firewall-scripting/](https://resources.infosecinstitute.com/nmap-evade-firewall-scripting/)

[https://dzone.com/articles/firewall-bypassing-techniques-with-nmap-and-hping3?fbclid=IwAR1wc5PEh58QlhqA1EPOazVDcUdAdPFClKQs4IBb7JeOZKyVMzBZtdb3zbI](https://dzone.com/articles/firewall-bypassing-techniques-with-nmap-and-hping3?fbclid=IwAR1wc5PEh58QlhqA1EPOazVDcUdAdPFClKQs4IBb7JeOZKyVMzBZtdb3zbI)

1. Obfuscation with Unicode or character replacement with %20 for example
2. Encryption
3. Session fragmenting; 1 person multiple packets with \_**colasoft** \_for example
4. Session splicing; Multiple IP-addresses each a part of the packet
5. Fragmentation
6. Decoy
7. Timing
8. Source port

**With Nmap**

**5. Fragmenting**

`-f or -f -f` = **fragmenting** packets or double. Does not work with -sT and -sV

**6. Decoy**

`-D` = **Decoy**, does not work with -sT and -sV `nmap -sS -D 192.168.1.1,192,168.1.10,192,168.1.101,ME [targetIP]`

**7. Timing**

`-T1` or `T2` and `--max-retries=1`

**8. Source port**

`nmap -sS --source-port 53 [targetIP]` or `nmap -sS -g 80 [targetIP]` as DNS is almost always allowed

`--spoof-mac apple` or `--spoof-mac 0 or --spoof-mac 00:11:22:33:44:55`

Scan with Active connect in order to weed out any spoofed ports designed to troll you

```text
 \`nmap -p1-65535 -A -T5 -sT $ip\`
```

**XML to HTML**

**xsltproc nmap-full.xml –output mailserver.html**

then show it in Firefox: `firefox-esr mailserver.html`

