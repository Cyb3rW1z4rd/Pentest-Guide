# 139 - SMB/NETBios

```text

```

## Netbios and Windows shares

![](../../.gitbook/assets/bb962072.ch11xx01_big-l-en-us.gif)

#### Network Basic Input Output System \(NetBIOS\)

**NetBIOS** stands for _Network Basic Input Output System_

It is a software protocol that allows applications, PCs, and Desktops on a local area network \(LAN\) to communicate with network hardware and to transmit data across the network. Software applications that run on a NetBIOS network locate and identify each other via their NetBIOS names. A NetBIOS name is up to 16 characters long and usually, separate from the computer name. Two applications start a NetBIOS session when one \(the client\) sends a command to “call” another client \(the server\) over **TCP Port 139**

* Programming interface
* Allows computer communication over a LAN
* _**Used to share files and printers**_
  * requires Server Message Block \(SMB\)

**SMB \(Server Message Block\) protocol - see Port 445**

* used among other things for file sharing in Windows NT/2000/XP. In windows NT it ran on top of NBT \(Netbios over TCP/IP\), which used the famous ports 137, 138 \(UDP\) and 139 \(TCP\)
* In Windows 2000/XP/2003, Microsoft added the possibility to run SMB directly over TCP/IP without the extra layer of NetBT. For this TCP port 445 is used.

**UNC - Universal Naming Convention** `\\ServerName\ShareName\file.nat`

Administrative shares which are used by system administrators and Windows itself like: `\\ComputerName\C$` or `\\ComputerName\admin$"`

### Null Sessions

Null session attacks can be used to enumerate a lot of information. Attackers can steal information about: Passwords, System users, System groups, Running system processes. Null sessions are remotely exploitable. This means that attackers can use their computer to attack a vulnerable Windows machine. **Nowadays Windows is configured to be immune from this kind of attack. Legacy hosts can still be vulnerable.**

> A null session attack exploits an authentication vulnerability for Windows Administrative Shares. This lets an attacker connect to a local or remote share without authentication.

#### Commands

**Windows**

`nbtstat /?` Displays protocol statistics and current TCP/IP connections using NBT \(NetBIOS over TCP/IP\)

`nbtstat -A 10.130.40.80` displays information about computer. `type <20>` indicates that file sharing service is running on this machine. Now we know that File and Printer service is running we cab enumerate the shares with the NET VIEW command.

[https://www.lifewire.com/net-command-2618094](https://www.lifewire.com/net-command-2618094)

[https://support.microsoft.com/en-us/help/556003](https://support.microsoft.com/en-us/help/556003)

`NET VIEW 10.130.40.80` for enumeration the shares

`NET USE \\\<target IP adress>\IPC$ ' ' /u: ' '`

`NET USE\10.10.10.16\e""\user:""`

**Linux**

On Linux with Samba tools `nmblookup --help` for displaying the manual

`nmblookup -A 10.130.40.80`

The following steps is to use `smbclient` to acces Windows shares and enumerate them. It also shows administrative shares that are hidden when using Windows standard tools.

`smbclient -L //192.168.0.27 (-N)`

`-L` to see what services are available

`-N`forces the tool to not ask for a password

> Once we have detected that File and Printer sharing is enabled and we have enumerated the available shares, it's time to check if a Null Session Attack is possible. We will exploit the IPC$ administrative share by trying to connect without credentials.

or on Linux with

`smbclient //10.130.40.8/IPC$ -N or access a share with smbclient \\\\192.168.99.162\\WorkSharing -N`

`IPC =` Inter Process Communication

* Netbios Information Scanning

  `nbtscan -r $ip/24`



**nmap**

Nmap Scan for Open SMB Shares

nmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 192.168.10.0/24

`--script=smb-enum-shares 192.168.0.27`

`nmap --script=smb-enum-users 192.168.0.27 -p 137,139`

`nmap --script=smb-brute 192.168.0.27`

* Nmap find exposed Netbios servers

  `nmap -sU --script nbstat.nse -p 137 $ip`

nmap --script=smb-check-vulns --script-args=unsafe=1 192.168.102.128 now is `nmap -p 139,445 --script=smb-vuln* 192.168.0.18`

