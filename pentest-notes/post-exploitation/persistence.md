# Persistence

Account

Trojan

Backdoor

SET Toolkit

## Packing Files

```text
-------------------------------------------------------------------------------------------------------------

-   Ultimate Packer for eXecutables
    upx -9 nc.exe

-   exe2bat - Converts EXE to a text file that can be copied and pasted
    locate exe2bat
    wine exe2bat.exe nc.exe nc.txt

-   Veil - Evasion Framework -
    https://github.com/Veil-Framework/Veil-Evasion

    apt-get -y install git
    git clone https://github.com/Veil-Framework/Veil-Evasion.git
    cd Veil-Evasion/
    cd setup
    setup.sh -c
```

## Crypting Known Malware with Software Protectors

* One such open source crypter, called Hyperion

  \`cp /usr/share/windows-binaries/Hyperion-1.0.zip

  unzip Hyperion-1.0.zip

  cd Hyperion-1.0/

  i686-w64-mingw32-g++ Src/Crypter/\*.cpp -o hyperion.exe

  cp -p /usr/lib/gcc/i686-w64-mingw32/5.3-win32/libgcc\_s\_sjlj-1.dll .

  cp -p /usr/lib/gcc/i686-w64-mingw32/5.3-win32/libstdc++-6.dll .

  wine hyperion.exe ../backdoor.exe ../crypted.exe\`

## Real example

Monitoring the use of elevated privileges can also detect advanced persistent threat \(APT\) activities. As an example, the U.S. Department of Homeland Security \(DHS\) and the Federal Bureau of Investigation \(FBI\) released a technical alert \(TA17-239A\) describing the activities of an APT targeting energy, nuclear, water, aviation, and some critical manufacturing sectors, along with some government entities in late 2017.

The alert details how attackers infected a single system with a malicious phishing email or by exploiting server vulnerabilities. Once they exploited a single system, they escalated their privileges and began performing many common privileged operations including the following:

* Accessing and deleting logs
* Creating and manipulating accounts \(such as adding new accounts to the administrators group\)
* Controlling communication paths \(such as opening port 3389 to enable the Remote Desktop Protocol and/or disabling the host firewall\) 
* Running various scripts \(including PowerShell, batch, and JavaScript files\) 
* Creating and scheduling tasks \(such as one that logged their accounts out after eight hours to mimic the behavior of a regular user\) 

Monitoring common privileged operations can detect these activities early in the attack. In contrast, if the actions go undetected, the APT can remain embedded in the network for years.

