# Sniffing - Wireshark etc

1. Denial of service
2. Sniffing
3. Compromising
4. Spoofing

Wireshark, TCPdump for sniffing

Dsniff and Bettercap for MiTM

**The following list summarizes when ARP is used:**

* A host desires to send a packet to another host in the same network
* A host desires to reach another host beyond his local network and needs the gateway hardware address
* A router needs to forward a packet for one host through another router
* A router needs to forward a packet to the destination host on the same network

## Sniffing

#### SPAN - Port Mirroring

The switch sends a copy of all network packets to the SPAN port. You need to have physical access to the switch.

#### MAC-flooding

Stress the switch and fill the cam-table.The switch turns into a hub and forwards to all ports on the switch.

#### ARP-poisoning

Redirecting trafic of certain machines to attacker machine. So the trafic can be monitored and changed. ARP=Address Resolution Protocol to match IP addresses with Layer 2 MAC addresses.

**Host Poisoning**

man in the middle, two way traffic

**Gateway Poisoning**

calling i'm the gateway, i'm the gateway, i'm the gateway. Redirecting all gateway traffic to host.

### Dsniff![](../../.gitbook/assets/schermafbeelding-2018-11-18-om-13.47.56.png)

`dsniff -i tap0` it then show automatically the authentication credentials when used

#### Macof![](../../.gitbook/assets/schermafbeelding-2018-11-19-om-20.56.00.png)

`echo 1 > /proc/sys/net/ipv4/ip_forward` before running the arpspoof command to enable IP forwarding on your attacker machine

#### Arpspoof

`arp -a` for arp table

`echo 1 > /proc/sys/net/ipv4/ip_forward` before running the arpspoof command to enable IP forwarding on your attacker machine.

`arpspoof -i tap0 -t 172.16.5.15 172.16.5.1` \(gateway spoofing\) and `arpspoof -i tap0 172.16.5.1 172.16.5.15` for changing both the arp tables in the target and the gateway.

## Wireshark

[http://packetlife.net/media/library/13/Wireshark\_Display\_Filters.pdf](http://packetlife.net/media/library/13/Wireshark_Display_Filters.pdf)

* Show only SMTP \(port 25\) and ICMP traffic:

  tcp.port eq 25 or icmp

* Show only traffic in the LAN \(192.168.x.x\), between workstations and servers -- no Internet:

  ip.src==192.168.0.0/16 and ip.dst==192.168.0.0/16

* Filter by a protocol \( e.g. SIP \) and filter out unwanted IPs:

  ip.src != xxx.xxx.xxx.xxx && ip.dst != xxx.xxx.xxx.xxx && sip

* Some commands are equal

  ip.addr == xxx.xxx.xxx.xxx

  Equals

  ip.src == xxx.xxx.xxx.xxx or ip.dst == xxx.xxx.xxx.xxx

  ```text
   ip.addr != xxx.xxx.xxx.xxx

     Equals

    ip.src != xxx.xxx.xxx.xxx or ip.dst != xxx.xxx.xxx.xxx
  ```

## ![](../../.gitbook/assets/auth-basic.png)

## Tcpdump

[https://danielmiessler.com/study/tcpdump/](https://danielmiessler.com/study/tcpdump/)

**There are three main types of expression**:`type`,`dir`, and`proto`.

* Type options are:`host, net`, and`port, portrange`
* Direction lets you do`src`, `dst` , and combinations thereof
* Proto\(col\) lets you designate:`tcp`,`udp`,`icmp`, `arp`, `ah`, and many more
* Operators: `and or`

**-D: Show the list of available interfaces**

`tcpdump -i eth0 -vvvASs 0 src 192.168.1.80 and dst 192.168.1.11`

`tcpdump -i eth0 -xxAXXSs 0 src 192.168.1.80` and dst 192.168.1.11![](../../.gitbook/assets/schermafbeelding-2018-11-18-om-14.53.42.png)Display a pcap file

* `tcpdump -r passwordz.pcap`
* Display ips and filter and sort

  `tcpdump -n -r passwordz.pcap | awk -F" " '{print $3}' | sort -u | head`

* Grab a packet capture on port 80

  `tcpdump tcp port 80 -w output.pcap -i eth0`

* Check for ACK or PSH flag set in a TCP packet

  `tcpdump -A -n 'tcp[13] = 24' -r passwordz.pcap`

`-i any`: Listen on all interfaces just to see if you’re seeing any traffic.

`-i eth0:` Listen on the eth0 interface.

`-l`: Line-readable output \(for viewing as you save, or sending to other commands\)

`-A`: Display output in ASCII.

`-n`: Don’t resolve hostnames.

`-nn`: Don’t resolve hostnames \_or \_port names.

`-q:` Be less verbose \(more quiet\) with your output.

`-t:` Give human-readable timestamp output.

`-tttt:` Give maximally human-readable timestamp output.

`-X:` Show the packet’s \_contents \_in both [hex](https://en.wikipedia.org/wiki/Hexidecimal) and [ascii](https://en.wikipedia.org/wiki/Ascii).

`-XX`: Same as -X, but also shows the ethernet header.

`-v, -vv, -vvv:` Increase the amount of packet information you get back.

`-c`: Only get \_x \_number of packets and then stop.

`-s:` Define the _snaplength_ \(size\) of the capture in bytes. Use

`-s0` to get everything, unless you are intentionally capturing less.

`-S:` Print absolute sequence numbers.

`-e:` Get the ethernet header as well.

`-q:`Show less protocol information.

`-E:` Decrypt IPSEC traffic by providing an encryption key.

Wireshark automatically decodes the bae64 encoded text. With TCPdump we can do it with **Burp** or as follows:

`echo QWRtaW4yOnBhc3N3b3JkMg== | base64 -d`

**CAPTURE PACKETS ON ETH0 IN ASCII AND HEX AND WRITE TO FILE**

tcpdump -i ethO -XX -w out.pcap

**CAPTURE HTTP TRAFFIC TO 2 . 2 . 2 . 2**

tcpdump -i ethO port 80 dst 2.2.2.2

**SHOW CONNECTIONS TO A SPECIFIC IP**

tcpdump -i ethO -tttt dst 192.168.1.22 and not net 192.168.1.0/24

**PRINT ALL PING RESPONSES**

tcpdump -i ethO 'icmp\[icmptype\] == icmp-echoreply'

**CAPTURE 50 DNS PACKETS AND PRINT TIMESTAMP**

tcpdump -i ethO -c 50 -tttt. 'udp and port 53'

**CAPTURE TCP TRAFFIC ON PORT 22-23**

Tcpdump -nvvX -sO -i ethO tcp portrange 22-23

**CAPTURE TRAFFIC TO SPECIFIC IP EXCLUDING SPECIFIC SUBNET**

tcpdump -i ethO -tttt dstip. and not net 1.1.1.0/24

**CAPTURE TRAFFIC B/W LOCAL-192 .1**

tcpdump net 192.1.1

**CAPTURE TRAFFIC FOR &lt;SEC&gt; SECONDS**

dumpcap -i ethO -a duration: sec. -w file file.pcap

## Bettercap

[https://danielmiessler.com/study/bettercap/](https://danielmiessler.com/study/bettercap/)

[https://github.com/bettercap/bettercap/wiki](https://github.com/bettercap/bettercap/wiki)

First find the targets in the network

`bettercap -I tap0 --no-spoofing`

## P0F

`p0f -i eth0 -o pof-log.txt`

## Ettercap

`ettercap -G` to start up the graphical interface

`sniff` = `unified sniffing` then select interface like `eth0`

`hosts -> scan for hosts` select hosts to attack

`Mitm -> arp poisoning`for Man in the middle attack

`view -> connections` to show packets

#### Intercept SSL trafic

`/etc/ettercap/etter.conf`; change uid and gid to 0

in the `redir_`_\`command_`_`on/off\` section uncomment the iptables lines

